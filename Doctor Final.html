<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Intelligent EMR | Doctor Dashboard</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Inter', sans-serif;
        }

        :root {
            --primary-color: #2a6e8f;
            --primary-light: #e8f4fc;
            --secondary-color: #4a9bcc;
            --accent-color: #36a18b;
            --warning-color: #e67e22;
            --danger-color: #e74c3c;
            --success-color: #2ecc71;
            --text-dark: #333333;
            --text-medium: #555555;
            --text-light: #777777;
            --bg-light: #f9fafc;
            --border-color: #e1e5eb;
            --sidebar-width: 280px;
            --header-height: 70px;
            --card-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
            --hover-shadow: 0 6px 16px rgba(0, 0, 0, 0.08);
        }

        body {
            background-color: var(--bg-light);
            color: var(--text-dark);
            display: flex;
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* Sidebar Styles */
        .sidebar {
            width: var(--sidebar-width);
            background-color: white;
            height: 100vh;
            position: fixed;
            left: 0;
            top: 0;
            border-right: 1px solid var(--border-color);
            display: flex;
            flex-direction: column;
            z-index: 100;
            transition: all 0.3s ease;
        }

        .sidebar-header {
            padding: 24px 20px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .logo {
            width: 40px;
            height: 40px;
            background-color: var(--primary-color);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 20px;
            font-weight: 700;
        }

        .logo-text {
            font-size: 18px;
            font-weight: 700;
            color: var(--primary-color);
        }

        .nav-menu {
            flex: 1;
            padding: 20px 0;
        }

        .nav-item {
            display: flex;
            align-items: center;
            padding: 14px 20px;
            margin: 4px 10px;
            border-radius: 8px;
            color: var(--text-medium);
            cursor: pointer;
            transition: all 0.2s ease;
            text-decoration: none;
        }

        .nav-item:hover {
            background-color: var(--primary-light);
            color: var(--primary-color);
        }

        .nav-item.active {
            background-color: var(--primary-light);
            color: var(--primary-color);
            font-weight: 600;
        }

        .nav-item i {
            width: 24px;
            margin-right: 12px;
            font-size: 18px;
        }

        .sidebar-footer {
            padding: 20px;
            border-top: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: var(--primary-color);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
        }

        .user-info h4 {
            font-size: 15px;
            font-weight: 600;
            margin-bottom: 2px;
        }

        .user-info p {
            font-size: 13px;
            color: var(--text-light);
        }

        /* Main Content Styles */
        .main-content {
            flex: 1;
            margin-left: var(--sidebar-width);
            padding: 0;
            width: calc(100% - var(--sidebar-width));
            min-height: 100vh;
        }

        .header {
            height: var(--header-height);
            background-color: white;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 30px;
            position: sticky;
            top: 0;
            z-index: 99;
        }

        .header-title h1 {
            font-size: 22px;
            font-weight: 600;
            color: var(--text-dark);
        }

        .header-actions {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .notification {
            position: relative;
            cursor: pointer;
            font-size: 20px;
            color: var(--text-medium);
        }

        .notification-badge {
            position: absolute;
            top: -6px;
            right: -6px;
            width: 18px;
            height: 18px;
            background-color: #ff4757;
            color: white;
            border-radius: 50%;
            font-size: 11px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .search-box {
            display: flex;
            align-items: center;
            background-color: var(--bg-light);
            border-radius: 8px;
            padding: 10px 16px;
            width: 300px;
            border: 1px solid var(--border-color);
        }

        .search-box input {
            border: none;
            background: transparent;
            width: 100%;
            padding-left: 10px;
            font-size: 15px;
            color: var(--text-dark);
            outline: none;
        }

        .search-box i {
            color: var(--text-light);
        }

        .content {
            padding: 30px;
            max-width: 1600px;
        }

        /* Section Management */
        .section {
            display: none;
        }

        .section.active {
            display: block;
        }

        /* Dashboard Section */
        .stats-cards {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .card {
            background-color: white;
            border-radius: 12px;
            padding: 22px;
            box-shadow: var(--card-shadow);
            transition: all 0.3s ease;
            border: 1px solid var(--border-color);
            cursor: pointer;
        }

        .card:hover {
            box-shadow: var(--hover-shadow);
            transform: translateY(-3px);
        }

        .card-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 12px;
        }

        .card-icon {
            width: 50px;
            height: 50px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 22px;
            color: white;
        }

        .card-icon.consultation {
            background-color: var(--primary-color);
        }

        .card-icon.prescription {
            background-color: var(--accent-color);
        }

        .card-icon.waiting {
            background-color: #e67e22;
        }

        .card-icon.revenue {
            background-color: #9c56b8;
        }

        .card-count {
            font-size: 26px;
            font-weight: 700;
            color: var(--text-dark);
            margin-bottom: 4px;
        }

        .card-title {
            font-size: 15px;
            color: var(--text-medium);
            font-weight: 500;
        }

        .card-trend {
            font-size: 13px;
            color: #36a18b;
            font-weight: 500;
            margin-top: 6px;
        }

        .card-trend.down {
            color: #e74c3c;
        }

        /* Revenue Amount Toggle */
        .revenue-toggle-container {
            display: flex;
            align-items: center;
            justify-content: flex-end;
            margin-top: 8px;
        }

        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 24px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 34px;
        }

        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 16px;
            width: 16px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .toggle-slider {
            background-color: var(--primary-color);
        }

        input:checked + .toggle-slider:before {
            transform: translateX(26px);
        }

        .toggle-label {
            font-size: 12px;
            color: var(--text-light);
            margin-right: 8px;
        }

        .revenue-amount {
            font-size: 26px;
            font-weight: 700;
            color: var(--text-dark);
            margin-bottom: 4px;
            transition: all 0.3s ease;
        }

        .revenue-amount.hidden {
            color: transparent;
            text-shadow: 0 0 8px rgba(0, 0, 0, 0.2);
        }

        /* Consultation Queue */
        .consultation-queue {
            background-color: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: var(--card-shadow);
            border: 1px solid var(--border-color);
            margin-bottom: 30px;
        }

        .queue-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 20px;
        }

        .queue-title {
            font-size: 20px;
            font-weight: 600;
            color: var(--text-dark);
        }

        /* Table Styles */
        .table-container {
            overflow-x: auto;
            border-radius: 8px;
            border: 1px solid var(--border-color);
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th {
            padding: 16px 20px;
            text-align: left;
            font-weight: 600;
            color: var(--text-dark);
            border-bottom: 1px solid var(--border-color);
            background-color: var(--bg-light);
        }

        td {
            padding: 16px 20px;
            border-bottom: 1px solid var(--border-color);
            color: var(--text-medium);
        }

        tr:hover {
            background-color: var(--primary-light);
        }

        .status {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 13px;
            font-weight: 500;
        }

        .status.waiting {
            background-color: #fff3cd;
            color: #856404;
        }

        .status.completed {
            background-color: #d4edda;
            color: #155724;
        }

        .priority {
            padding: 4px 10px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 600;
        }

        .priority.high {
            background-color: #f8d7da;
            color: #721c24;
        }

        .priority.medium {
            background-color: #fff3cd;
            color: #856404;
        }

        .priority.low {
            background-color: #d4edda;
            color: #155724;
        }

        .action-btn {
            padding: 6px 12px;
            border-radius: 6px;
            background-color: transparent;
            border: 1px solid var(--border-color);
            color: var(--text-medium);
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 13px;
            margin-right: 8px;
            display: inline-flex;
            align-items: center;
            gap: 5px;
        }

        .action-btn:hover {
            background-color: var(--primary-light);
            color: var(--primary-color);
            border-color: var(--primary-color);
        }

        /* Modal Styles - UPDATED FOR ELONGATED WIDTH */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .modal-content {
            background-color: white;
            border-radius: 12px;
            width: 95%;
            max-width: 1800px; /* Increased width */
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }

        .modal-header {
            padding: 20px 30px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .modal-title {
            font-size: 20px;
            font-weight: 600;
            color: var(--text-dark);
        }

        .close-modal {
            background: none;
            border: none;
            font-size: 24px;
            color: var(--text-light);
            cursor: pointer;
            transition: color 0.2s;
        }

        .close-modal:hover {
            color: var(--text-dark);
        }

        .modal-body {
            padding: 25px;
        }

        /* Alert Items */
        .alert-item {
            padding: 10px;
            border-radius: 8px;
            font-size: 13px;
            display: flex;
            align-items: flex-start;
            gap: 10px;
        }

        .alert-item.danger {
            background-color: #f8d7da;
            color: #721c24;
            border-left: 4px solid #e74c3c;
        }

        .alert-item.warning {
            background-color: #fff3cd;
            color: #856404;
            border-left: 4px solid #ffc107;
        }

        .alert-item.info {
            background-color: #d1ecf1;
            color: #0c5460;
            border-left: 4px solid #17a2b8;
        }

        /* UPDATED: Prescription Cards Layout - LARGER and ELONGATED */
        .prescription-cards-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); /* Increased min-width */
            gap: 20px;
            margin-bottom: 20px;
        }

        .prescription-card {
            background-color: white;
            border-radius: 10px;
            padding: 20px; /* Increased padding */
            box-shadow: var(--card-shadow);
            border: 1px solid var(--border-color);
            min-height: 200px; /* Ensure cards have decent height */
        }

        .prescription-card h3 {
            font-size: 16px; /* Increased font size */
            font-weight: 600;
            color: var(--primary-color);
            margin-bottom: 16px; /* Increased margin */
            padding-bottom: 10px;
            border-bottom: 1px solid var(--primary-light);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        /* UPDATED: Patient Details Card - LARGER */
        .patient-details-enhanced {
            font-size: 14px !important; /* Increased from 11px */
        }

        .patient-details-enhanced .detail-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 12px; /* Increased spacing */
            align-items: flex-start;
        }

        .patient-details-enhanced .detail-label {
            font-size: 12px; /* Increased from 10px */
            color: var(--text-dark); /* Darker for better visibility */
            font-weight: 600;
            min-width: 110px; /* Increased min-width */
        }

        .patient-details-enhanced .detail-value {
            font-size: 13px; /* Increased from 11px */
            font-weight: 500;
            color: var(--text-dark);
            text-align: right;
            flex: 1;
        }

        /* UPDATED: Vitals Card - LARGER */
        .vitals-grid-enhanced {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px; /* Increased gap */
            margin-bottom: 15px;
        }

        .vital-card-enhanced {
            background-color: #f8f9fa;
            border-radius: 8px;
            padding: 12px; /* Increased padding */
            text-align: center;
            border: 1px solid #e9ecef;
            min-height: 70px;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .vital-value-enhanced {
            font-size: 16px; /* Increased from 13px */
            font-weight: 700;
            color: var(--primary-color);
            margin-bottom: 4px;
            line-height: 1.2;
        }

        .vital-label-enhanced {
            font-size: 11px; /* Increased from 9px */
            color: var(--text-medium);
            font-weight: 600;
        }

        .vital-unit-enhanced {
            font-size: 10px; /* Increased from 8px */
            color: var(--text-light);
            margin-top: 2px;
        }

        /* UPDATED: Diagnosis Card - LARGER */
        .diagnosis-card-enhanced {
            font-size: 14px !important; /* Increased from 11px */
        }

        .diagnosis-card-enhanced textarea {
            font-size: 13px; /* Increased from 11px */
            padding: 12px; /* Increased padding */
            min-height: 100px; /* Increased height */
        }

        /* UPDATED: Medicine Card - LARGER */
        .medicine-card-enhanced {
            font-size: 14px !important; /* Increased from 11px */
        }

        .medicine-card-enhanced textarea {
            font-size: 13px; /* Increased from 11px */
            padding: 12px; /* Increased padding */
            min-height: 100px; /* Increased height */
        }

        /* UPDATED: Test Card - LARGER */
        .test-card-enhanced {
            font-size: 14px !important; /* Increased from 11px */
        }

        .test-card-enhanced textarea {
            font-size: 13px; /* Increased from 11px */
            padding: 12px; /* Increased padding */
            min-height: 80px; /* Increased height */
        }

        /* UPDATED: Advice Card - LARGER */
        .advice-card-enhanced {
            font-size: 14px !important; /* Increased from 11px */
        }

        .advice-card-enhanced textarea {
            font-size: 13px; /* Increased from 11px */
            padding: 12px; /* Increased padding */
            min-height: 80px; /* Increased height */
        }

        /* Diagnosis Toggle */
        .diagnosis-toggle-container {
            display: flex;
            align-items: center;
            justify-content: flex-start;
            margin-bottom: 20px; /* Increased margin */
            background-color: #f8f9fa;
            padding: 12px 16px; /* Increased padding */
            border-radius: 8px;
            border: 1px solid #dee2e6;
            font-size: 13px; /* Increased font size */
        }

        .diagnosis-toggle {
            position: relative;
            display: inline-block;
            width: 140px;
            height: 28px;
            margin: 0 10px;
        }

        .diagnosis-toggle input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .diagnosis-toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #4a9bcc;
            transition: .4s;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 6px;
        }

        .diagnosis-toggle-slider:before {
            position: absolute;
            content: "";
            height: 22px;
            width: 68px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            transition: .4s;
            border-radius: 4px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        .diagnosis-toggle-option {
            color: white;
            font-size: 11px;
            font-weight: 600;
            z-index: 1;
            width: 68px;
            text-align: center;
        }

        input:checked + .diagnosis-toggle-slider:before {
            transform: translateX(68px);
        }

        /* Form Elements - UPDATED for larger size */
        .form-group {
            margin-bottom: 18px; /* Increased margin */
        }

        .form-group label {
            display: block;
            margin-bottom: 8px; /* Increased margin */
            font-weight: 600; /* Bolder labels */
            color: var(--text-dark);
            font-size: 13px; /* Increased from 11px */
        }

        input, select, textarea {
            width: 100%;
            padding: 10px 14px; /* Increased padding */
            border: 1px solid var(--border-color);
            border-radius: 8px;
            font-size: 13px; /* Increased from 12px */
            color: var(--text-dark);
            transition: border 0.3s;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 2px rgba(42, 110, 143, 0.1);
        }

        textarea {
            resize: vertical;
        }

        /* NEW: View PA Documents Button */
        .view-pa-docs-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            padding: 8px 16px;
            background-color: var(--accent-color);
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 6px;
            transition: all 0.2s ease;
            z-index: 10;
        }

        .view-pa-docs-btn:hover {
            background-color: #2d8f78;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        /* NEW: PA Documents Modal */
        .pa-documents-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 2000;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .pa-documents-content {
            background-color: white;
            border-radius: 12px;
            width: 90%;
            max-width: 1200px;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.15);
        }

        .pa-docs-header {
            padding: 20px 30px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .pa-docs-title {
            font-size: 20px;
            font-weight: 600;
            color: var(--text-dark);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .pa-docs-body {
            padding: 25px 30px;
        }

        .pa-docs-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .pa-doc-card {
            background-color: white;
            border-radius: 8px;
            padding: 20px;
            border: 1px solid var(--border-color);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.05);
            transition: all 0.2s ease;
            cursor: pointer;
        }

        .pa-doc-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
            border-color: var(--primary-color);
        }

        .pa-doc-icon {
            width: 50px;
            height: 50px;
            border-radius: 8px;
            background-color: var(--primary-light);
            color: var(--primary-color);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 22px;
            margin-bottom: 15px;
        }

        .pa-doc-title {
            font-weight: 600;
            color: var(--text-dark);
            margin-bottom: 8px;
            font-size: 15px;
        }

        .pa-doc-info {
            font-size: 12px;
            color: var(--text-light);
            margin-bottom: 5px;
        }

        .pa-doc-date {
            font-size: 11px;
            color: var(--text-light);
            font-style: italic;
        }

        /* NEW: View Prescription Modal */
        .view-prescription-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            z-index: 2000;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .view-prescription-content {
            background-color: white;
            border-radius: 12px;
            width: 90%;
            max-width: 1400px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 15px 50px rgba(0, 0, 0, 0.2);
        }

        /* Professional A4 Prescription */
        .final-prescription {
            background-color: white;
            padding: 25px;
            width: 210mm;
            min-height: 297mm;
            margin: 0 auto;
            font-family: 'Georgia', serif;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
            position: relative;
            overflow: hidden;
            font-size: 12px;
        }

        .prescription-header {
            text-align: center;
            margin-bottom: 25px;
            padding-bottom: 12px;
            border-bottom: 2px solid var(--primary-color);
        }

        .hospital-name {
            font-size: 22px;
            font-weight: 700;
            color: var(--primary-color);
            margin-bottom: 4px;
            letter-spacing: 1px;
        }

        .hospital-address {
            color: var(--text-medium);
            font-size: 10px;
            margin-bottom: 6px;
        }

        .hospital-contact {
            color: var(--text-dark);
            font-size: 10px;
            font-weight: 500;
        }

        .prescription-title {
            font-size: 20px;
            font-weight: 700;
            color: var(--text-dark);
            margin: 12px 0;
            text-decoration: underline;
            text-underline-offset: 4px;
        }

        .prescription-patient-info {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-bottom: 20px;
            padding: 12px;
            background-color: #f8f9fa;
            border-radius: 6px;
            border: 1px solid #dee2e6;
            font-size: 11px;
        }

        .prescription-field {
            margin-bottom: 8px;
        }

        .prescription-label {
            font-weight: 600;
            color: var(--text-dark);
            margin-bottom: 2px;
            font-size: 10px;
            display: inline-block;
            min-width: 110px;
        }

        .prescription-value {
            display: inline-block;
            font-size: 11px;
            color: #2c3e50;
            padding: 2px 0;
            border-bottom: 1px dashed #95a5a6;
            min-width: 150px;
        }

        .section-divider {
            border-top: 2px solid #34495e;
            margin: 15px 0;
        }

        .prescription-medications {
            margin: 20px 0;
        }

        .medication-table {
            width: 100%;
            border-collapse: collapse;
            margin: 12px 0;
            border: 2px solid #2c3e50;
            font-size: 11px;
        }

        .medication-table th {
            background-color: #2c3e50;
            color: white;
            padding: 8px;
            text-align: left;
            border: 1px solid #34495e;
            font-weight: 600;
            font-size: 11px;
        }

        .medication-table td {
            padding: 8px;
            border: 1px solid #bdc3c7;
            font-size: 11px;
        }

        .medication-table tr:nth-child(even) {
            background-color: #f8f9fa;
        }

        .doctor-signature {
            margin-top: 50px;
            text-align: right;
            padding-top: 15px;
            border-top: 2px solid #2c3e50;
        }

        .signature-line {
            width: 220px;
            border-top: 2px solid #2c3e50;
            display: inline-block;
            margin-top: 30px;
        }

        .doctor-info {
            text-align: right;
            margin-top: 6px;
        }

        .doctor-name {
            font-size: 14px;
            font-weight: 700;
            color: #2c3e50;
            margin-bottom: 3px;
        }

        .doctor-credentials {
            font-size: 10px;
            color: #7f8c8d;
            margin-bottom: 3px;
        }

        .footer-stamp {
            position: absolute;
            bottom: 25px;
            left: 0;
            right: 0;
            text-align: center;
            font-style: italic;
            color: #7f8c8d;
            border-top: 1px dashed #bdc3c7;
            padding-top: 12px;
            font-size: 10px;
        }

        .stamp-overlay {
            position: absolute;
            right: 70px;
            bottom: 100px;
            opacity: 0.2;
            transform: rotate(-15deg);
            color: var(--primary-color);
            font-size: 50px;
            font-weight: bold;
        }

        .compact-section {
            margin: 12px 0;
            padding: 10px;
            background-color: #f8f9fa;
            border-radius: 6px;
            border-left: 3px solid #3498db;
            font-size: 11px;
        }

        .compact-section-title {
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 6px;
            font-size: 12px;
        }

        /* PA Assessment Styles */
        .pa-assessment {
            background-color: #fff8e1;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
            border-left: 4px solid #ffb300;
            font-size: 11px;
        }

        .pa-info {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            font-size: 11px;
        }

        .pa-name {
            font-weight: 600;
            color: #e67e22;
        }

        .pa-time {
            color: var(--text-light);
        }

        .assessment-findings {
            background-color: white;
            padding: 12px;
            border-radius: 6px;
            border: 1px solid #ffeaa7;
            font-size: 11px;
            line-height: 1.4;
        }

        .assessment-section {
            margin-bottom: 6px;
        }

        .assessment-label {
            font-weight: 600;
            color: var(--text-dark);
            display: inline-block;
            min-width: 120px;
            font-size: 10px;
        }

        /* Footer */
        .footer {
            text-align: center;
            padding: 20px;
            color: var(--text-light);
            font-size: 13px;
            border-top: 1px solid var(--border-color);
            margin-top: 30px;
        }

        /* Buttons */
        .btn {
            padding: 8px 16px;
            border-radius: 6px;
            font-weight: 600;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.2s ease;
            border: none;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
        }

        .btn-primary {
            background-color: var(--primary-color);
            color: white;
        }

        .btn-primary:hover {
            background-color: var(--secondary-color);
        }

        .btn-outline {
            background-color: transparent;
            color: var(--primary-color);
            border: 1px solid var(--primary-color);
        }

        .btn-outline:hover {
            background-color: var(--primary-light);
        }

        .btn-success {
            background-color: var(--success-color);
            color: white;
        }

        /* Responsive Design */
        @media (max-width: 1200px) {
            .stats-cards {
                grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            }
            
            .prescription-cards-container {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .vitals-grid-enhanced {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 1100px) {
            .sidebar {
                transform: translateX(-100%);
            }
            
            .main-content {
                margin-left: 0;
                width: 100%;
            }
            
            .sidebar.active {
                transform: translateX(0);
            }
            
            .mobile-toggle {
                display: block !important;
            }
            
            .modal-content {
                width: 98%;
            }
        }

        @media (max-width: 768px) {
            .stats-cards {
                grid-template-columns: 1fr;
            }
            
            .header {
                padding: 0 20px;
            }
            
            .content {
                padding: 20px;
            }
            
            .search-box {
                width: 200px;
            }
            
            .prescription-cards-container {
                grid-template-columns: 1fr;
            }
            
            .vitals-grid-enhanced {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .prescription-patient-info {
                grid-template-columns: 1fr;
            }
            
            .modal-body {
                padding: 15px;
            }
            
            .view-pa-docs-btn {
                position: relative;
                top: 0;
                right: 0;
                margin-bottom: 15px;
                align-self: flex-end;
            }
        }

        @media (max-width: 480px) {
            .vitals-grid-enhanced {
                grid-template-columns: 1fr;
            }
            
            .patient-details-enhanced .detail-row {
                flex-direction: column;
                margin-bottom: 10px;
            }
            
            .patient-details-enhanced .detail-label,
            .patient-details-enhanced .detail-value {
                text-align: left;
                width: 100%;
            }
            
            .patient-details-enhanced .detail-value {
                margin-top: 2px;
            }
        }

        .mobile-toggle {
            display: none;
            background: none;
            border: none;
            font-size: 24px;
            color: var(--text-dark);
            cursor: pointer;
            padding: 10px;
        }

        /* Print Styles */
        @media print {
            body * {
                visibility: hidden;
            }
            .final-prescription, .final-prescription * {
                visibility: visible;
            }
            .final-prescription {
                position: absolute;
                left: 0;
                top: 0;
                width: 210mm;
                min-height: 297mm;
                margin: 0;
                padding: 15mm;
                box-shadow: none;
                font-size: 11px;
            }
            .hospital-name {
                font-size: 20px;
            }
            .prescription-title {
                font-size: 18px;
            }
            .prescription-label {
                font-size: 9px;
            }
            .prescription-value {
                font-size: 10px;
            }
            .medication-table th,
            .medication-table td {
                padding: 6px;
                font-size: 10px;
            }
            .no-print {
                display: none !important;
            }
        }

        /* Transition Effects */
        .fade-in {
            animation: fadeIn 0.3s ease-in-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
    </style>
</head>
<body>
    <!-- Sidebar -->
    <div class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <div class="logo">EMR</div>
            <div class="logo-text">IntelliEMR</div>
        </div>
        
        <div class="nav-menu">
            <a href="#" class="nav-item active" data-page="dashboard">
                <i class="fas fa-tachometer-alt"></i>
                <span>Dashboard</span>
            </a>
            <a href="#" class="nav-item" data-page="consultationQueue">
                <i class="fas fa-user-md"></i>
                <span>Consultation Queue</span>
            </a>
            <a href="#" class="nav-item" data-page="patientRecords">
                <i class="fas fa-user-injured"></i>
                <span>Patient Records</span>
            </a>
            <a href="#" class="nav-item" data-page="prescriptions">
                <i class="fas fa-prescription"></i>
                <span>Prescription Management</span>
            </a>
            <a href="#" class="nav-item" data-page="settings">
                <i class="fas fa-cog"></i>
                <span>Settings</span>
            </a>
        </div>
        
        <div class="sidebar-footer">
            <div class="user-avatar">DR</div>
            <div class="user-info">
                <h4>Dr. Anil Sharma</h4>
                <p>General Physician</p>
            </div>
        </div>
    </div>
    
    <!-- Main Content -->
    <div class="main-content">
        <!-- Header -->
        <div class="header">
            <button class="mobile-toggle" id="mobileToggle">
                <i class="fas fa-bars"></i>
            </button>
            <div class="header-title">
                <h1 id="pageTitle">Doctor Dashboard</h1>
            </div>
            
            <div class="header-actions">
                <div class="search-box">
                    <i class="fas fa-search"></i>
                    <input type="text" id="globalSearch" placeholder="Search patients, records...">
                </div>
                
                <div class="notification" id="notificationBtn">
                    <i class="far fa-bell"></i>
                    <div class="notification-badge">5</div>
                </div>
            </div>
        </div>
        
        <!-- Content Area -->
        <div class="content">
            <!-- Dashboard Section -->
            <div class="section active" id="dashboardSection">
                <!-- Stats Cards -->
                <div class="stats-cards">
                    <div class="card" id="todaysConsultationsCard">
                        <div class="card-header">
                            <div>
                                <div class="card-count">8</div>
                                <div class="card-title">Today's Consultations</div>
                            </div>
                            <div class="card-icon consultation">
                                <i class="fas fa-stethoscope"></i>
                            </div>
                        </div>
                        <div class="card-trend">+2 from yesterday</div>
                    </div>
                    
                    <div class="card" id="waitingPatientsCard">
                        <div class="card-header">
                            <div>
                                <div class="card-count">3</div>
                                <div class="card-title">Ready for Consultation</div>
                            </div>
                            <div class="card-icon waiting">
                                <i class="fas fa-clock"></i>
                            </div>
                        </div>
                        <div class="card-trend down">-1 from yesterday</div>
                    </div>
                    
                    <div class="card" id="prescriptionsCard">
                        <div class="card-header">
                            <div>
                                <div class="card-count">12</div>
                                <div class="card-title">Prescriptions Today</div>
                            </div>
                            <div class="card-icon prescription">
                                <i class="fas fa-prescription"></i>
                            </div>
                        </div>
                        <div class="card-trend">+4 this week</div>
                    </div>
                    
                    <div class="card" id="revenueCard">
                        <div class="card-header">
                            <div>
                                <div class="revenue-amount" id="revenueAmount">â‚¹ 45,600</div>
                                <div class="card-title">Monthly Revenue</div>
                            </div>
                            <div class="card-icon revenue">
                                <i class="fas fa-rupee-sign"></i>
                            </div>
                        </div>
                        <div class="revenue-toggle-container">
                            <span class="toggle-label">Hide Amount</span>
                            <label class="toggle-switch">
                                <input type="checkbox" id="revenueToggle">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                    </div>
                </div>
                
                <!-- Consultation Queue (on dashboard) -->
                <div class="consultation-queue">
                    <div class="queue-header">
                        <h2 class="queue-title">Patients Ready for Consultation</h2>
                        <div class="queue-controls">
                            <button class="btn btn-outline" id="refreshQueueBtn">
                                <i class="fas fa-sync-alt"></i>
                                Refresh
                            </button>
                            <button class="btn btn-primary" id="callNextPatientBtn">
                                <i class="fas fa-user-plus"></i>
                                Call Next Patient
                            </button>
                        </div>
                    </div>
                    
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>Queue No.</th>
                                    <th>Patient Name</th>
                                    <th>Age/Gender</th>
                                    <th>Chief Complaint</th>
                                    <th>PA Assessment</th>
                                    <th>Priority</th>
                                    <th>Wait Time</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="dashboardQueueTable">
                                <!-- Filled by JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            
            <!-- Consultation Queue Section -->
            <div class="section" id="consultationQueueSection">
                <div class="section-header">
                    <h2 class="section-title">Consultation Queue</h2>
                    <div class="queue-controls">
                        <button class="btn btn-outline" id="refreshFullQueueBtn">
                            <i class="fas fa-sync-alt"></i>
                            Refresh Queue
                        </button>
                        <button class="btn btn-primary" id="callNextFullBtn">
                            <i class="fas fa-user-plus"></i>
                            Call Next Patient
                        </button>
                    </div>
                </div>
                
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Queue No.</th>
                                <th>Patient Name</th>
                                <th>Age/Gender</th>
                                <th>Chief Complaint</th>
                                <th>PA Assessment</th>
                                <th>Vitals</th>
                                <th>Priority</th>
                                <th>Wait Time</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="consultationQueueTable">
                            <!-- Filled by JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- Patient Records Section -->
            <div class="section" id="patientRecordsSection">
                <div class="section-header">
                    <h2 class="section-title">Patient Records</h2>
                    <div style="display: flex; gap: 15px;">
                        <div class="search-box" style="width: 300px;">
                            <i class="fas fa-search"></i>
                            <input type="text" id="patientSearch" placeholder="Search patients...">
                        </div>
                    </div>
                </div>
                
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Patient ID</th>
                                <th>Patient Name</th>
                                <th>Age/Gender</th>
                                <th>Last Consultation</th>
                                <th>Chief Complaint</th>
                                <th>PA Assessment</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="patientRecordsTable">
                            <!-- Filled by JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- Prescription Management Section -->
            <div class="section" id="prescriptionsSection">
                <div class="section-header">
                    <h2 class="section-title">Prescription Management</h2>
                    <div style="display: flex; gap: 15px;">
                        <div class="search-box" style="width: 300px;">
                            <i class="fas fa-search"></i>
                            <input type="text" id="prescriptionSearch" placeholder="Search prescriptions...">
                        </div>
                        <button class="btn btn-outline" id="viewFinalPrescriptionBtn">
                            <i class="fas fa-file-medical"></i>
                            View Sample Prescription
                        </button>
                    </div>
                </div>
                
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Prescription ID</th>
                                <th>Patient Name</th>
                                <th>Date</th>
                                <th>Medications</th>
                                <th>Refills</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="prescriptionsTable">
                            <!-- Filled by JavaScript -->
                        </tbody>
                    </table>
                </div>
                
                <!-- Final Prescription View -->
                <div id="finalPrescriptionView" style="display: none; margin-top: 30px;">
                    <div class="final-prescription" id="printablePrescription">
                        <!-- Prescription content will be loaded by JavaScript -->
                    </div>
                    
                    <div style="display: flex; gap: 15px; margin-top: 30px; justify-content: center;">
                        <button class="btn btn-primary" id="printFinalPrescriptionBtn">
                            <i class="fas fa-print"></i>
                            Print Prescription
                        </button>
                        <button class="btn btn-outline" id="closeFinalPrescriptionBtn">
                            <i class="fas fa-times"></i>
                            Close View
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- Settings Section -->
            <div class="section" id="settingsSection">
                <div class="section-header">
                    <h2 class="section-title">Settings</h2>
                </div>
                
                <div class="consultation-container">
                    <!-- Account Settings -->
                    <div class="patient-info-section">
                        <h3 style="margin-bottom: 20px;"><i class="fas fa-user-cog"></i> Account Settings</h3>
                        
                        <div class="form-group">
                            <label for="doctorName">Full Name</label>
                            <input type="text" id="doctorName" value="Dr. Anil Sharma">
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="doctorSpecialty">Specialty</label>
                                <input type="text" id="doctorSpecialty" value="General Physician">
                            </div>
                            <div class="form-group">
                                <label for="doctorLicense">Medical License</label>
                                <input type="text" id="doctorLicense" value="MED123456">
                            </div>
                        </div>
                        
                        <button class="btn btn-primary" style="margin-top: 20px; width: 100%;">
                            <i class="fas fa-save"></i>
                            Save Changes
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- Footer -->
            <div class="footer">
                <p>Intelligent Electronic Medical Records System v2.1 | Â© 2023 IntelliEMR. All rights reserved.</p>
                <p style="margin-top: 10px; font-size: 12px; color: var(--text-light);">
                    PA Workflow: Patient Registration â†’ PA Assessment â†’ Doctor Consultation â†’ Prescription
                </p>
            </div>
        </div>
    </div>
    
    <!-- Prescription Modal - UPDATED for larger size -->
    <div class="modal" id="prescriptionModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Prescription</h2>
                <button class="close-modal" id="closePrescriptionModal">&times;</button>
            </div>
            <div class="modal-body">
                <!-- NEW: View PA Documents Button -->
                <button class="view-pa-docs-btn" id="viewPaDocumentsBtn">
                    <i class="fas fa-file-medical-alt"></i>
                    View PA Documents
                </button>
                
                <div id="prescriptionFormContent">
                    <!-- Prescription form will be loaded here by JavaScript -->
                </div>
            </div>
        </div>
    </div>

    <!-- NEW: PA Documents Modal -->
    <div class="modal pa-documents-modal" id="paDocumentsModal">
        <div class="pa-documents-content">
            <div class="pa-docs-header">
                <h2 class="pa-docs-title"><i class="fas fa-file-medical-alt"></i> PA Uploaded Documents</h2>
                <button class="close-modal" id="closePaDocsModal">&times;</button>
            </div>
            <div class="pa-docs-body">
                <p>Documents uploaded by the Physician Assistant for this patient:</p>
                <div class="pa-docs-grid" id="paDocsGrid">
                    <!-- PA documents will be loaded here by JavaScript -->
                </div>
            </div>
        </div>
    </div>

    <!-- NEW: View Prescription Modal -->
    <div class="modal view-prescription-modal" id="viewPrescriptionModal">
        <div class="view-prescription-content">
            <div class="modal-header">
                <h2 class="modal-title">Final Prescription</h2>
                <button class="close-modal" id="closeViewPrescriptionModal">&times;</button>
            </div>
            <div class="modal-body" id="viewPrescriptionBody">
                <!-- Final prescription will be loaded here by JavaScript -->
            </div>
        </div>
    </div>

    <script>
        // Enhanced Sample Data with PA Workflow
        const patientsWithPA = [
            {
                id: "PT-2023-0012",
                name: "Rajesh Kumar",
                age: 42,
                gender: "Male",
                phone: "+91 98765 43210",
                registeredBy: "John Mathew (PA)",
                registrationTime: "09:30 AM",
                paAssessment: {
                    paName: "John Mathew",
                    paTime: "10:00 AM",
                    chiefComplaint: "Fever and cough for 3 days, mild headache",
                    vitals: {
                        temperature: "100.2Â°F",
                        bloodPressure: "130/85 mmHg",
                        pulseRate: "78/min",
                        respiratoryRate: "18/min",
                        oxygenSaturation: "98%",
                        height: "175 cm",
                        weight: "75 kg",
                        bmi: "24.5",
                        bloodGroup: "B+",
                        glucose: "98 mg/dL"
                    },
                    assessment: "Probable upper respiratory infection. No breathing difficulty noted. Patient afebrile now.",
                    allergies: "Penicillin (rash and itching)",
                    medicalHistory: "Hypertension - 5 years, controlled with medication",
                    priority: "High"
                },
                paDocuments: [
                    { id: "DOC001", name: "Patient Consent Form", type: "Form", date: "2023-10-15", uploadedBy: "John Mathew" },
                    { id: "DOC002", name: "Lab Test Results", type: "Report", date: "2023-10-14", uploadedBy: "John Mathew" },
                    { id: "DOC003", name: "Previous Prescription", type: "Prescription", date: "2023-09-20", uploadedBy: "John Mathew" },
                    { id: "DOC004", name: "Insurance Card Copy", type: "Insurance", date: "2023-10-15", uploadedBy: "John Mathew" },
                    { id: "DOC005", name: "ECG Report", type: "Medical Report", date: "2023-10-10", uploadedBy: "John Mathew" }
                ],
                lastVisit: "2023-10-15",
                nextAppointment: "2023-11-15",
                chiefComplaint: "Fever and cough for 3 days",
                status: "ready",
                queueNo: "DQ-01",
                waitTime: "15 mins"
            },
            {
                id: "PT-2023-0011",
                name: "Meena Desai",
                age: 35,
                gender: "Female",
                phone: "+91 98765 43212",
                registeredBy: "Sarah Johnson (PA)",
                registrationTime: "09:45 AM",
                paAssessment: {
                    paName: "Sarah Johnson",
                    paTime: "10:15 AM",
                    chiefComplaint: "Severe abdominal pain and nausea since morning",
                    vitals: {
                        temperature: "98.6Â°F",
                        bloodPressure: "120/80 mmHg",
                        pulseRate: "72/min",
                        respiratoryRate: "16/min",
                        oxygenSaturation: "99%",
                        height: "162 cm",
                        weight: "58 kg",
                        bmi: "22.1",
                        bloodGroup: "O+",
                        glucose: "102 mg/dL"
                    },
                    assessment: "Acute abdominal pain, likely gastritis. No fever. Mild tenderness in epigastric region.",
                    allergies: "None known",
                    medicalHistory: "No chronic conditions. Last delivery: 2019 (C-section)",
                    priority: "High"
                },
                paDocuments: [
                    { id: "DOC006", name: "Patient History Form", type: "Form", date: "2023-10-15", uploadedBy: "Sarah Johnson" },
                    { id: "DOC007", name: "Ultrasound Report", type: "Report", date: "2023-10-10", uploadedBy: "Sarah Johnson" }
                ],
                lastVisit: "2023-10-15",
                nextAppointment: "2023-10-22",
                chiefComplaint: "Abdominal pain and nausea",
                status: "ready",
                queueNo: "DQ-02",
                waitTime: "10 mins"
            },
            {
                id: "PT-2023-0010",
                name: "Arun Patel",
                age: 58,
                gender: "Male",
                phone: "+91 98765 43214",
                registeredBy: "Robert Chen (PA)",
                registrationTime: "10:00 AM",
                paAssessment: {
                    paName: "Robert Chen",
                    paTime: "10:30 AM",
                    chiefComplaint: "Hypertension follow-up, routine check",
                    vitals: {
                        temperature: "98.4Â°F",
                        bloodPressure: "145/90 mmHg",
                        pulseRate: "76/min",
                        respiratoryRate: "17/min",
                        oxygenSaturation: "97%",
                        height: "168 cm",
                        weight: "82 kg",
                        bmi: "29.1",
                        bloodGroup: "A+",
                        glucose: "118 mg/dL"
                    },
                    assessment: "Controlled hypertension. Patient compliant with medication. No new complaints.",
                    allergies: "None",
                    medicalHistory: "Diabetes Type 2, Hypertension - both well controlled",
                    priority: "Medium"
                },
                paDocuments: [
                    { id: "DOC008", name: "Blood Test Results", type: "Report", date: "2023-10-13", uploadedBy: "Robert Chen" },
                    { id: "DOC009", name: "Previous Consultation Notes", type: "Notes", date: "2023-09-15", uploadedBy: "Robert Chen" }
                ],
                lastVisit: "2023-10-14",
                nextAppointment: "2023-10-28",
                chiefComplaint: "Hypertension follow-up",
                status: "ready",
                queueNo: "DQ-03",
                waitTime: "5 mins"
            }
        ];

        const consultationQueue = patientsWithPA.map(patient => ({
            ...patient,
            priority: patient.paAssessment.priority
        }));

        // Enhanced prescriptions data with more details for viewing
        const prescriptions = [
            {
                id: "RX-2023-0012",
                patient: "Rajesh Kumar",
                patientId: "PT-2023-0012",
                date: "2023-10-15",
                medications: ["Amoxicillin 500mg", "Paracetamol 500mg", "Cough Syrup"],
                diagnosis: "Acute Upper Respiratory Infection",
                clinicalNotes: "Confirmed PA findings. Mild pharyngeal erythema noted. No tonsillar exudate. Lung fields clear.",
                advice: "1. Take adequate rest for 3-5 days\n2. Drink plenty of warm fluids\n3. Follow up if symptoms worsen\n4. Next review in 7 days",
                tests: "Complete Blood Count (CBC) if fever persists beyond 3 days\nChest X-ray if cough persists beyond 5 days",
                doctor: "Dr. Anil Sharma",
                refills: 0,
                status: "active",
                isFinal: true
            },
            {
                id: "RX-2023-0011",
                patient: "Meena Desai",
                patientId: "PT-2023-0011",
                date: "2023-10-15",
                medications: ["Pantoprazole 40mg", "Domperidone 10mg"],
                diagnosis: "Acute Gastritis",
                clinicalNotes: "Mild epigastric tenderness. No guarding or rigidity. Bowel sounds normal.",
                advice: "1. Avoid spicy and oily food\n2. Take small frequent meals\n3. Follow up in 3 days",
                tests: "Upper GI Endoscopy if symptoms persist",
                doctor: "Dr. Anil Sharma",
                refills: 1,
                status: "active",
                isFinal: true
            }
        ];

        // DOM Elements
        const sidebar = document.getElementById('sidebar');
        const mobileToggle = document.getElementById('mobileToggle');
        const pageTitle = document.getElementById('pageTitle');
        const revenueAmount = document.getElementById('revenueAmount');
        const revenueToggle = document.getElementById('revenueToggle');
        const sections = document.querySelectorAll('.section');
        const navItems = document.querySelectorAll('.nav-item');
        const prescriptionModal = document.getElementById('prescriptionModal');
        const paDocumentsModal = document.getElementById('paDocumentsModal');
        const viewPrescriptionModal = document.getElementById('viewPrescriptionModal');
        const finalPrescriptionView = document.getElementById('finalPrescriptionView');
        let currentPatientForPrescription = null;

        // Initialize the dashboard
        document.addEventListener('DOMContentLoaded', () => {
            // Load sample data into tables
            populateDashboardQueue();
            populateConsultationQueue();
            populatePatientRecordsTable();
            populatePrescriptionsTable();
            
            // Set up event listeners
            setupEventListeners();
            
            console.log('Enhanced Intelligent EMR Doctor Dashboard loaded successfully.');
        });

        // Populate tables with sample data
        function populateDashboardQueue() {
            const dashboardQueueTable = document.getElementById('dashboardQueueTable');
            if (!dashboardQueueTable) return;
            
            dashboardQueueTable.innerHTML = '';
            consultationQueue.forEach(patient => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td><strong>${patient.queueNo}</strong></td>
                    <td>
                        <div><strong>${patient.name}</strong></div>
                        <div style="font-size: 11px; color: var(--text-light);">ID: ${patient.id}</div>
                    </td>
                    <td>${patient.age} / ${patient.gender}</td>
                    <td>${patient.chiefComplaint}</td>
                    <td>
                        <div style="font-size: 11px;">
                            <div><i class="fas fa-user-nurse"></i> ${patient.paAssessment.paName}</div>
                            <div>${patient.paAssessment.assessment.substring(0, 40)}...</div>
                        </div>
                    </td>
                    <td><span class="priority ${patient.priority.toLowerCase()}">${patient.priority}</span></td>
                    <td>${patient.waitTime}</td>
                    <td>
                        <button class="action-btn start-consult-btn" data-id="${patient.id}">
                            <i class="fas fa-prescription"></i> Prescribe
                        </button>
                    </td>
                `;
                dashboardQueueTable.appendChild(row);
            });
        }

        function populateConsultationQueue() {
            const consultationQueueTable = document.getElementById('consultationQueueTable');
            if (!consultationQueueTable) return;
            
            consultationQueueTable.innerHTML = '';
            consultationQueue.forEach(patient => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td><strong>${patient.queueNo}</strong></td>
                    <td>
                        <div><strong>${patient.name}</strong></div>
                        <div style="font-size: 11px; color: var(--text-light);">ID: ${patient.id}</div>
                    </td>
                    <td>${patient.age} / ${patient.gender}</td>
                    <td>${patient.chiefComplaint}</td>
                    <td>
                        <div style="font-size: 11px;">
                            <div><strong><i class="fas fa-user-nurse"></i> ${patient.paAssessment.paName}</strong></div>
                            <div style="color: var(--text-light); font-size: 10px;">${patient.paAssessment.paTime}</div>
                        </div>
                    </td>
                    <td>
                        <div style="font-size: 10px;">
                            <div>Temp: ${patient.paAssessment.vitals.temperature.split(' ')[0]}</div>
                            <div>BP: ${patient.paAssessment.vitals.bloodPressure.split(' ')[0]}</div>
                        </div>
                    </td>
                    <td><span class="priority ${patient.priority.toLowerCase()}">${patient.priority}</span></td>
                    <td>${patient.waitTime}</td>
                    <td>
                        <button class="action-btn start-consult-btn" data-id="${patient.id}">
                            <i class="fas fa-prescription"></i> Prescribe
                        </button>
                    </td>
                `;
                consultationQueueTable.appendChild(row);
            });
        }

        function populatePatientRecordsTable() {
            const patientRecordsTable = document.getElementById('patientRecordsTable');
            if (!patientRecordsTable) return;
            
            patientRecordsTable.innerHTML = '';
            patientsWithPA.forEach(patient => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td><strong>${patient.id}</strong></td>
                    <td>
                        <div><strong>${patient.name}</strong></div>
                        <div style="font-size: 11px; color: var(--text-light);">${patient.phone}</div>
                    </td>
                    <td>${patient.age} / ${patient.gender}</td>
                    <td>${patient.lastVisit}</td>
                    <td>${patient.chiefComplaint}</td>
                    <td>
                        <div style="font-size: 11px;">
                            <div><i class="fas fa-user-nurse"></i> ${patient.registeredBy}</div>
                            <div style="color: var(--text-light); font-size: 10px;">${patient.registrationTime}</div>
                        </div>
                    </td>
                    <td><span class="status ${patient.status}">${patient.status === 'ready' ? 'Ready' : 'Completed'}</span></td>
                    <td>
                        <button class="action-btn view-patient-btn" data-id="${patient.id}">
                            <i class="fas fa-eye"></i> View
                        </button>
                        <button class="action-btn start-consult-btn" data-id="${patient.id}">
                            <i class="fas fa-prescription"></i> Prescribe
                        </button>
                    </td>
                `;
                patientRecordsTable.appendChild(row);
            });
        }

        function populatePrescriptionsTable() {
            const prescriptionsTable = document.getElementById('prescriptionsTable');
            if (!prescriptionsTable) return;
            
            prescriptionsTable.innerHTML = '';
            prescriptions.forEach(prescription => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td><strong>${prescription.id}</strong></td>
                    <td>
                        <div><strong>${prescription.patient}</strong></div>
                        <div style="font-size: 11px; color: var(--text-light);">ID: ${prescription.patientId}</div>
                    </td>
                    <td>${prescription.date}</td>
                    <td>${prescription.medications.join(', ')}</td>
                    <td>${prescription.refills}</td>
                    <td><span class="status active">Active</span></td>
                    <td>
                        <button class="action-btn view-final-prescription-btn" data-id="${prescription.id}">
                            <i class="fas fa-file-medical-alt"></i> View Final
                        </button>
                        <button class="action-btn" data-action="print" data-id="${prescription.id}">
                            <i class="fas fa-print"></i> Print
                        </button>
                    </td>
                `;
                prescriptionsTable.appendChild(row);
            });
        }

        function showPrescriptionModal(patientId = null) {
            const patient = patientId ? 
                patientsWithPA.find(p => p.id === patientId) : 
                patientsWithPA[0];
            
            currentPatientForPrescription = patient;
            
            const content = document.getElementById('prescriptionFormContent');
            content.innerHTML = `
                <div class="diagnosis-toggle-container">
                    <span>Diagnosis Type:</span>
                    <label class="diagnosis-toggle">
                        <input type="checkbox" id="diagnosisToggle" checked>
                        <span class="diagnosis-toggle-slider">
                            <span class="diagnosis-toggle-option">Provisional</span>
                            <span class="diagnosis-toggle-option">Final</span>
                        </span>
                    </label>
                </div>
                
                <div class="prescription-cards-container">
                    <!-- Patient Details Card - ENHANCED (LARGER) -->
                    <div class="prescription-card patient-details-enhanced">
                        <h3><i class="fas fa-user-injured"></i> Patient Details</h3>
                        <div class="detail-row">
                            <div class="detail-label">Patient Name:</div>
                            <div class="detail-value">${patient.name}</div>
                        </div>
                        <div class="detail-row">
                            <div class="detail-label">Patient ID:</div>
                            <div class="detail-value">${patient.id}</div>
                        </div>
                        <div class="detail-row">
                            <div class="detail-label">Age & Gender:</div>
                            <div class="detail-value">${patient.age} years / ${patient.gender}</div>
                        </div>
                        <div class="detail-row">
                            <div class="detail-label">Contact Number:</div>
                            <div class="detail-value">${patient.phone}</div>
                        </div>
                        <div class="detail-row">
                            <div class="detail-label">Last Consultation:</div>
                            <div class="detail-value">${patient.lastVisit}</div>
                        </div>
                        <div class="detail-row">
                            <div class="detail-label">Next Appointment:</div>
                            <div class="detail-value">${patient.nextAppointment}</div>
                        </div>
                        <div class="detail-row">
                            <div class="detail-label">Assessed by PA:</div>
                            <div class="detail-value">${patient.paAssessment.paName}</div>
                        </div>
                        <div class="detail-row">
                            <div class="detail-label">Assessment Time:</div>
                            <div class="detail-value">${patient.paAssessment.paTime}</div>
                        </div>
                    </div>
                    
                    <!-- Patient Vitals Card - ENHANCED (LARGER) -->
                    <div class="prescription-card">
                        <h3><i class="fas fa-heartbeat"></i> Patient Vitals</h3>
                        <div class="vitals-grid-enhanced">
                            <div class="vital-card-enhanced">
                                <div class="vital-value-enhanced">${patient.paAssessment.vitals.temperature}</div>
                                <div class="vital-label-enhanced">Temperature</div>
                            </div>
                            <div class="vital-card-enhanced">
                                <div class="vital-value-enhanced">${patient.paAssessment.vitals.bloodPressure}</div>
                                <div class="vital-label-enhanced">Blood Pressure</div>
                            </div>
                            <div class="vital-card-enhanced">
                                <div class="vital-value-enhanced">${patient.paAssessment.vitals.pulseRate}</div>
                                <div class="vital-label-enhanced">Pulse Rate</div>
                            </div>
                            <div class="vital-card-enhanced">
                                <div class="vital-value-enhanced">${patient.paAssessment.vitals.respiratoryRate}</div>
                                <div class="vital-label-enhanced">Resp. Rate</div>
                            </div>
                            <div class="vital-card-enhanced">
                                <div class="vital-value-enhanced">${patient.paAssessment.vitals.oxygenSaturation}</div>
                                <div class="vital-label-enhanced">SpOâ‚‚</div>
                            </div>
                            <div class="vital-card-enhanced">
                                <div class="vital-value-enhanced">${patient.paAssessment.vitals.height}</div>
                                <div class="vital-label-enhanced">Height</div>
                            </div>
                            <div class="vital-card-enhanced">
                                <div class="vital-value-enhanced">${patient.paAssessment.vitals.weight}</div>
                                <div class="vital-label-enhanced">Weight</div>
                            </div>
                            <div class="vital-card-enhanced">
                                <div class="vital-value-enhanced">${patient.paAssessment.vitals.bmi}</div>
                                <div class="vital-label-enhanced">BMI</div>
                            </div>
                            <div class="vital-card-enhanced">
                                <div class="vital-value-enhanced">${patient.paAssessment.vitals.bloodGroup}</div>
                                <div class="vital-label-enhanced">Blood Group</div>
                            </div>
                        </div>
                        <div style="margin-top: 10px; font-size: 11px; color: var(--text-light); text-align: center;">
                            Recorded by: ${patient.paAssessment.paName} at ${patient.paAssessment.paTime}
                        </div>
                    </div>
                </div>
                
                <div class="prescription-cards-container">
                    <!-- Doctor's Diagnosis Card - ENHANCED (LARGER) -->
                    <div class="prescription-card diagnosis-card-enhanced">
                        <h3><i class="fas fa-diagnoses"></i> Diagnosis</h3>
                        <div class="form-group">
                            <label for="doctorDiagnosis">Diagnosis</label>
                            <textarea id="doctorDiagnosis" placeholder="Enter diagnosis...">Acute Upper Respiratory Infection</textarea>
                        </div>
                        <div class="form-group">
                            <label for="clinicalNotes">Clinical Notes</label>
                            <textarea id="clinicalNotes" placeholder="Add clinical notes...">Confirmed PA findings. Mild pharyngeal erythema noted. No tonsillar exudate. Lung fields clear.</textarea>
                        </div>
                    </div>
                    
                    <!-- Medicine Recommendations Card - ENHANCED (LARGER) -->
                    <div class="prescription-card medicine-card-enhanced">
                        <h3><i class="fas fa-pills"></i> Medicine Recommendations</h3>
                        <div class="form-group">
                            <label for="medications">Medications</label>
                            <textarea id="medications" placeholder="List medications with dosage...">Amoxicillin 500mg - Twice daily for 7 days
Paracetamol 500mg - As needed for fever
Vitamin C + Zinc - Once daily for immunity</textarea>
                        </div>
                    </div>
                </div>
                
                <div class="prescription-cards-container">
                    <!-- Test Recommendations Card - ENHANCED (LARGER) -->
                    <div class="prescription-card test-card-enhanced">
                        <h3><i class="fas fa-vial"></i> Test Recommendations</h3>
                        <div class="form-group">
                            <label for="tests">Recommended Tests</label>
                            <textarea id="tests" placeholder="List recommended tests...">Complete Blood Count (CBC) if fever persists beyond 3 days
Chest X-ray if cough persists beyond 5 days</textarea>
                        </div>
                    </div>
                    
                    <!-- General Advice Card - ENHANCED (LARGER) -->
                    <div class="prescription-card advice-card-enhanced">
                        <h3><i class="fas fa-comment-medical"></i> General Advice</h3>
                        <div class="form-group">
                            <label for="advice">Patient Advice</label>
                            <textarea id="advice" placeholder="Add general advice for patient...">1. Take adequate rest for 3-5 days
2. Drink plenty of warm fluids
3. Follow up if symptoms worsen
4. Next review in 7 days</textarea>
                        </div>
                    </div>
                </div>
                
                <!-- Allergy Alert -->
                <div class="alert-item danger" style="margin: 15px 0; padding: 12px; font-size: 13px;">
                    <i class="fas fa-allergies"></i>
                    <div>
                        <div style="font-weight: 600;">Allergy Alert</div>
                        <div>${patient.paAssessment.allergies}</div>
                    </div>
                </div>
                
                <!-- Medical History -->
                <div class="alert-item info" style="margin: 15px 0; padding: 12px; font-size: 13px;">
                    <i class="fas fa-history"></i>
                    <div>
                        <div style="font-weight: 600;">Medical History</div>
                        <div>${patient.paAssessment.medicalHistory}</div>
                    </div>
                </div>
                
                <!-- Action Buttons -->
                <div style="display: flex; gap: 12px; margin-top: 20px; justify-content: center;">
                    <button class="btn btn-outline" id="saveDraftBtn">
                        <i class="fas fa-save"></i>
                        Save Draft
                    </button>
                    <button class="btn btn-success" id="generatePrescriptionBtn">
                        <i class="fas fa-prescription"></i>
                        Generate Prescription
                    </button>
                </div>
            `;
            
            prescriptionModal.style.display = 'flex';
            document.body.style.overflow = 'hidden';
            
            // Add event listeners for prescription form buttons
            document.getElementById('saveDraftBtn').addEventListener('click', () => {
                alert('Prescription draft saved successfully!');
            });
            
            document.getElementById('generatePrescriptionBtn').addEventListener('click', () => {
                // Get form values
                const diagnosisType = document.getElementById('diagnosisToggle').checked ? 'Provisional' : 'Final';
                const diagnosis = document.getElementById('doctorDiagnosis').value;
                const clinicalNotes = document.getElementById('clinicalNotes').value;
                const medications = document.getElementById('medications').value;
                const tests = document.getElementById('tests').value;
                const advice = document.getElementById('advice').value;
                
                // Generate final prescription
                generateFinalPrescription(patient, diagnosisType, diagnosis, clinicalNotes, medications, tests, advice);
            });
        }

        // NEW: Show PA Documents Modal
        function showPaDocumentsModal(patientId) {
            const patient = patientsWithPA.find(p => p.id === patientId);
            if (!patient) return;
            
            const paDocsGrid = document.getElementById('paDocsGrid');
            paDocsGrid.innerHTML = '';
            
            if (patient.paDocuments && patient.paDocuments.length > 0) {
                patient.paDocuments.forEach(doc => {
                    const docCard = document.createElement('div');
                    docCard.className = 'pa-doc-card';
                    docCard.innerHTML = `
                        <div class="pa-doc-icon">
                            <i class="fas fa-file-${getDocIcon(doc.type)}"></i>
                        </div>
                        <div class="pa-doc-title">${doc.name}</div>
                        <div class="pa-doc-info">Type: ${doc.type}</div>
                        <div class="pa-doc-info">Uploaded by: ${doc.uploadedBy}</div>
                        <div class="pa-doc-date">Date: ${doc.date}</div>
                    `;
                    paDocsGrid.appendChild(docCard);
                });
            } else {
                paDocsGrid.innerHTML = '<p style="grid-column: 1 / -1; text-align: center; color: var(--text-light);">No documents uploaded by PA for this patient.</p>';
            }
            
            paDocumentsModal.style.display = 'flex';
            document.body.style.overflow = 'hidden';
        }

        // Helper function to get document icon
        function getDocIcon(docType) {
            switch(docType.toLowerCase()) {
                case 'form': return 'edit';
                case 'report': return 'chart-line';
                case 'prescription': return 'prescription';
                case 'insurance': return 'file-invoice-dollar';
                case 'medical report': return 'file-medical';
                case 'notes': return 'sticky-note';
                default: return 'file';
            }
        }

        // NEW: View Final Prescription from Prescription Management
        function viewFinalPrescription(prescriptionId) {
            const prescription = prescriptions.find(p => p.id === prescriptionId);
            if (!prescription) {
                alert('Prescription not found');
                return;
            }
            
            const patient = patientsWithPA.find(p => p.id === prescription.patientId);
            if (!patient) {
                alert('Patient data not found');
                return;
            }
            
            const viewPrescriptionBody = document.getElementById('viewPrescriptionBody');
            const today = new Date();
            const formattedDate = today.toLocaleDateString('en-IN', { day: 'numeric', month: 'long', year: 'numeric' });
            
            viewPrescriptionBody.innerHTML = `
                <div class="final-prescription" style="width: 100%; max-width: 800px; margin: 0 auto;">
                    <div class="prescription-header">
                        <div class="hospital-name">APOLLO HOSPITALS</div>
                        <div class="hospital-address">No. 21, Greams Road, Chennai - 600006, Tamil Nadu</div>
                        <div class="hospital-contact">Phone: 044-2829 3333 | Emergency: 044-2829 4444</div>
                        <div class="prescription-title">MEDICAL PRESCRIPTION</div>
                    </div>
                    
                    <div class="prescription-patient-info">
                        <div>
                            <div class="prescription-field">
                                <span class="prescription-label">Patient Name:</span>
                                <span class="prescription-value">${patient.name}</span>
                            </div>
                            <div class="prescription-field">
                                <span class="prescription-label">Age / Gender:</span>
                                <span class="prescription-value">${patient.age} Years / ${patient.gender}</span>
                            </div>
                            <div class="prescription-field">
                                <span class="prescription-label">Patient ID:</span>
                                <span class="prescription-value">${patient.id}</span>
                            </div>
                            <div class="prescription-field">
                                <span class="prescription-label">Blood Group:</span>
                                <span class="prescription-value">${patient.paAssessment.vitals.bloodGroup}</span>
                            </div>
                        </div>
                        <div>
                            <div class="prescription-field">
                                <span class="prescription-label">Date:</span>
                                <span class="prescription-value">${prescription.date}</span>
                            </div>
                            <div class="prescription-field">
                                <span class="prescription-label">Prescription ID:</span>
                                <span class="prescription-value">${prescription.id}</span>
                            </div>
                            <div class="prescription-field">
                                <span class="prescription-label">Diagnosis Type:</span>
                                <span class="prescription-value">Final Diagnosis</span>
                            </div>
                            <div class="prescription-field">
                                <span class="prescription-label">Weight/Height:</span>
                                <span class="prescription-value">${patient.paAssessment.vitals.weight} / ${patient.paAssessment.vitals.height}</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="section-divider"></div>
                    
                    <!-- Doctor's Diagnosis -->
                    <div class="compact-section">
                        <div class="compact-section-title">DOCTOR'S FINAL DIAGNOSIS</div>
                        <div style="margin-bottom: 6px;">
                            <strong>Diagnosis:</strong> ${prescription.diagnosis}
                        </div>
                        <div>
                            <strong>Clinical Findings:</strong> ${prescription.clinicalNotes}
                        </div>
                    </div>
                    
                    <!-- Medications -->
                    <div class="prescription-medications">
                        <div style="font-weight: 700; color: #2c3e50; margin-bottom: 10px; font-size: 14px; text-align: center;">MEDICATIONS PRESCRIBED</div>
                        <div style="white-space: pre-line; padding: 8px; background-color: #f8f9fa; border-radius: 6px; border: 1px solid #dee2e6; font-size: 11px;">
                            ${prescription.medications.join('\n')}
                        </div>
                    </div>
                    
                    <!-- Investigations & Advice -->
                    <div class="compact-section">
                        <div class="compact-section-title">INVESTIGATIONS ADVISED</div>
                        <div style="white-space: pre-line; font-size: 11px;">${prescription.tests}</div>
                    </div>
                    
                    <div class="compact-section">
                        <div class="compact-section-title">GENERAL ADVICE</div>
                        <div style="white-space: pre-line; font-size: 11px;">${prescription.advice}</div>
                    </div>
                    
                    <div style="margin: 12px 0; padding: 8px; background-color: #fff3cd; border-radius: 6px; border: 1px solid #ffeaa7; font-size: 11px;">
                        <strong>ALLERGIES:</strong> ${patient.paAssessment.allergies}
                    </div>
                    
                    <div class="doctor-signature">
                        <div class="doctor-info">
                            <div class="doctor-name">${prescription.doctor}</div>
                            <div class="doctor-credentials">MBBS, MD (General Medicine)</div>
                            <div class="doctor-credentials">Reg. No: MED123456 | MCI: 12345/2010</div>
                            <div class="doctor-credentials">Consultant Physician, Apollo Hospitals</div>
                        </div>
                        <div class="signature-line"></div>
                        <div style="margin-top: 4px; font-style: italic; color: #7f8c8d; font-size: 10px;">Signature & Seal</div>
                    </div>
                    
                    <div class="stamp-overlay">APOLLO HOSPITALS</div>
                    
                    <div class="footer-stamp">
                        This is a computer-generated prescription. Valid only with doctor's signature and hospital stamp.
                        <div style="margin-top: 6px; font-size: 9px;">Generated: ${formattedDate} | ID: ${prescription.id} | Valid for 30 days</div>
                    </div>
                </div>
                
                <div style="display: flex; gap: 12px; margin-top: 20px; justify-content: center;">
                    <button class="btn btn-primary" id="printViewedPrescriptionBtn">
                        <i class="fas fa-print"></i>
                        Print Prescription
                    </button>
                    <button class="btn btn-outline" id="closeViewPrescriptionBtn">
                        <i class="fas fa-times"></i>
                        Close
                    </button>
                </div>
            `;
            
            // Add event listeners for the view prescription modal buttons
            document.getElementById('printViewedPrescriptionBtn').addEventListener('click', () => {
                window.print();
            });
            
            document.getElementById('closeViewPrescriptionBtn').addEventListener('click', () => {
                viewPrescriptionModal.style.display = 'none';
                document.body.style.overflow = 'auto';
            });
            
            viewPrescriptionModal.style.display = 'flex';
            document.body.style.overflow = 'hidden';
        }

        function generateFinalPrescription(patient, diagnosisType, diagnosis, clinicalNotes, medications, tests, advice) {
            const today = new Date();
            const formattedDate = today.toLocaleDateString('en-IN', { day: 'numeric', month: 'long', year: 'numeric' });
            const formattedTime = today.toLocaleTimeString('en-IN', { hour: '2-digit', minute: '2-digit' });
            const prescriptionId = `RX-${today.getFullYear()}-${String(today.getMonth() + 1).padStart(2, '0')}${String(today.getDate()).padStart(2, '0')}${Math.floor(Math.random() * 100).toString().padStart(2, '0')}`;
            
            const content = document.getElementById('prescriptionFormContent');
            content.innerHTML = `
                <div class="final-prescription" style="width: 100%; max-width: 800px; margin: 0 auto;">
                    <div class="prescription-header">
                        <div class="hospital-name">APOLLO HOSPITALS</div>
                        <div class="hospital-address">No. 21, Greams Road, Chennai - 600006, Tamil Nadu</div>
                        <div class="hospital-contact">Phone: 044-2829 3333 | Emergency: 044-2829 4444</div>
                        <div class="prescription-title">MEDICAL PRESCRIPTION</div>
                    </div>
                    
                    <div class="prescription-patient-info">
                        <div>
                            <div class="prescription-field">
                                <span class="prescription-label">Patient Name:</span>
                                <span class="prescription-value">${patient.name}</span>
                            </div>
                            <div class="prescription-field">
                                <span class="prescription-label">Age / Gender:</span>
                                <span class="prescription-value">${patient.age} Years / ${patient.gender}</span>
                            </div>
                            <div class="prescription-field">
                                <span class="prescription-label">Patient ID:</span>
                                <span class="prescription-value">${patient.id}</span>
                            </div>
                            <div class="prescription-field">
                                <span class="prescription-label">Blood Group:</span>
                                <span class="prescription-value">${patient.paAssessment.vitals.bloodGroup}</span>
                            </div>
                        </div>
                        <div>
                            <div class="prescription-field">
                                <span class="prescription-label">Date:</span>
                                <span class="prescription-value">${formattedDate}</span>
                            </div>
                            <div class="prescription-field">
                                <span class="prescription-label">Prescription ID:</span>
                                <span class="prescription-value">${prescriptionId}</span>
                            </div>
                            <div class="prescription-field">
                                <span class="prescription-label">Diagnosis Type:</span>
                                <span class="prescription-value">${diagnosisType} Diagnosis</span>
                            </div>
                            <div class="prescription-field">
                                <span class="prescription-label">Weight/Height:</span>
                                <span class="prescription-value">${patient.paAssessment.vitals.weight} / ${patient.paAssessment.vitals.height}</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="section-divider"></div>
                    
                    <!-- PA Assessment -->
                    <div class="pa-assessment">
                        <div class="pa-info">
                            <div>
                                <span class="pa-name">PA Assessment by: ${patient.paAssessment.paName}</span>
                            </div>
                            <div class="pa-time">Time: ${patient.paAssessment.paTime}</div>
                        </div>
                        <div class="assessment-findings">
                            <div class="assessment-section">
                                <span class="assessment-label">Chief Complaint:</span>
                                <span>${patient.paAssessment.chiefComplaint}</span>
                            </div>
                            <div class="assessment-section">
                                <span class="assessment-label">Vitals:</span>
                                <span>Temp: ${patient.paAssessment.vitals.temperature}, BP: ${patient.paAssessment.vitals.bloodPressure}, Pulse: ${patient.paAssessment.vitals.pulseRate}, RR: ${patient.paAssessment.vitals.respiratoryRate}, SpO2: ${patient.paAssessment.vitals.oxygenSaturation}</span>
                            </div>
                            <div class="assessment-section">
                                <span class="assessment-label">Allergies:</span>
                                <span>${patient.paAssessment.allergies}</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Doctor's Diagnosis -->
                    <div class="compact-section">
                        <div class="compact-section-title">DOCTOR'S ${diagnosisType.toUpperCase()} DIAGNOSIS</div>
                        <div style="margin-bottom: 6px;">
                            <strong>Diagnosis:</strong> ${diagnosis}
                        </div>
                        <div>
                            <strong>Clinical Findings:</strong> ${clinicalNotes}
                        </div>
                    </div>
                    
                    <!-- Medications -->
                    <div class="prescription-medications">
                        <div style="font-weight: 700; color: #2c3e50; margin-bottom: 10px; font-size: 14px; text-align: center;">MEDICATIONS PRESCRIBED</div>
                        <div style="white-space: pre-line; padding: 8px; background-color: #f8f9fa; border-radius: 6px; border: 1px solid #dee2e6; font-size: 11px;">
                            ${medications}
                        </div>
                    </div>
                    
                    <!-- Investigations & Advice -->
                    <div class="compact-section">
                        <div class="compact-section-title">INVESTIGATIONS ADVISED</div>
                        <div style="white-space: pre-line; font-size: 11px;">${tests}</div>
                    </div>
                    
                    <div class="compact-section">
                        <div class="compact-section-title">GENERAL ADVICE</div>
                        <div style="white-space: pre-line; font-size: 11px;">${advice}</div>
                    </div>
                    
                    <div style="margin: 12px 0; padding: 8px; background-color: #fff3cd; border-radius: 6px; border: 1px solid #ffeaa7; font-size: 11px;">
                        <strong>ALLERGIES:</strong> ${patient.paAssessment.allergies}
                    </div>
                    
                    <div class="doctor-signature">
                        <div class="doctor-info">
                            <div class="doctor-name">Dr. Anil Sharma</div>
                            <div class="doctor-credentials">MBBS, MD (General Medicine)</div>
                            <div class="doctor-credentials">Reg. No: MED123456 | MCI: 12345/2010</div>
                            <div class="doctor-credentials">Consultant Physician, Apollo Hospitals</div>
                        </div>
                        <div class="signature-line"></div>
                        <div style="margin-top: 4px; font-style: italic; color: #7f8c8d; font-size: 10px;">Signature & Seal</div>
                    </div>
                    
                    <div class="stamp-overlay">APOLLO HOSPITALS</div>
                    
                    <div class="footer-stamp">
                        This is a computer-generated prescription. Valid only with doctor's signature and hospital stamp.
                        <div style="margin-top: 6px; font-size: 9px;">Generated: ${formattedDate} | ID: ${prescriptionId} | Valid for 30 days</div>
                    </div>
                </div>
                
                <div style="display: flex; gap: 12px; margin-top: 20px; justify-content: center;">
                    <button class="btn btn-outline" id="backToPrescriptionBtn">
                        <i class="fas fa-arrow-left"></i>
                        Back to Edit
                    </button>
                    <button class="btn btn-primary" id="saveFinalPrescriptionBtn">
                        <i class="fas fa-save"></i>
                        Save Prescription
                    </button>
                    <button class="btn btn-success" id="printFinalPrescriptionBtn">
                        <i class="fas fa-print"></i>
                        Print & Complete
                    </button>
                </div>
            `;
            
            // Add event listeners for final prescription buttons
            document.getElementById('backToPrescriptionBtn').addEventListener('click', () => {
                showPrescriptionModal(patient.id);
            });
            
            document.getElementById('saveFinalPrescriptionBtn').addEventListener('click', () => {
                // Add to prescriptions array
                prescriptions.push({
                    id: prescriptionId,
                    patient: patient.name,
                    patientId: patient.id,
                    date: formattedDate,
                    medications: medications.split('\n').filter(m => m.trim()),
                    diagnosis: diagnosis,
                    clinicalNotes: clinicalNotes,
                    advice: advice,
                    tests: tests,
                    doctor: "Dr. Anil Sharma",
                    refills: 0,
                    status: "active",
                    isFinal: true
                });
                
                alert('Prescription saved successfully! Consultation completed.');
                prescriptionModal.style.display = 'none';
                document.body.style.overflow = 'auto';
                
                // Update patient status
                const index = patientsWithPA.findIndex(p => p.id === patient.id);
                if (index !== -1) {
                    patientsWithPA[index].status = 'completed';
                    populateDashboardQueue();
                    populateConsultationQueue();
                    populatePatientRecordsTable();
                    populatePrescriptionsTable();
                }
            });
            
            document.getElementById('printFinalPrescriptionBtn').addEventListener('click', () => {
                window.print();
                
                // Add to prescriptions array
                prescriptions.push({
                    id: prescriptionId,
                    patient: patient.name,
                    patientId: patient.id,
                    date: formattedDate,
                    medications: medications.split('\n').filter(m => m.trim()),
                    diagnosis: diagnosis,
                    clinicalNotes: clinicalNotes,
                    advice: advice,
                    tests: tests,
                    doctor: "Dr. Anil Sharma",
                    refills: 0,
                    status: "active",
                    isFinal: true
                });
                
                alert('Prescription printed and consultation completed!');
                prescriptionModal.style.display = 'none';
                document.body.style.overflow = 'auto';
                
                // Update patient status
                const index = patientsWithPA.findIndex(p => p.id === patient.id);
                if (index !== -1) {
                    patientsWithPA[index].status = 'completed';
                    populateDashboardQueue();
                    populateConsultationQueue();
                    populatePatientRecordsTable();
                    populatePrescriptionsTable();
                }
            });
        }

        function showSamplePrescription() {
            const prescriptionContainer = document.getElementById('finalPrescriptionView');
            const printablePrescription = document.getElementById('printablePrescription');
            
            printablePrescription.innerHTML = `
                <div class="prescription-header">
                    <div class="hospital-name">APOLLO HOSPITALS</div>
                    <div class="hospital-address">No. 21, Greams Road, Chennai - 600006, Tamil Nadu</div>
                    <div class="hospital-contact">Phone: 044-2829 3333 | Emergency: 044-2829 4444 | Email: info@apollohospitals.com</div>
                    <div class="prescription-title">MEDICAL PRESCRIPTION</div>
                </div>
                
                <div class="prescription-patient-info">
                    <div>
                        <div class="prescription-field">
                            <span class="prescription-label">Patient Name:</span>
                            <span class="prescription-value">Rajesh Kumar</span>
                        </div>
                        <div class="prescription-field">
                            <span class="prescription-label">Age / Gender:</span>
                            <span class="prescription-value">42 Years / Male</span>
                        </div>
                        <div class="prescription-field">
                            <span class="prescription-label">Patient ID:</span>
                            <span class="prescription-value">PT-2023-0012</span>
                        </div>
                        <div class="prescription-field">
                            <span class="prescription-label">Blood Group:</span>
                            <span class="prescription-value">B+ (Rh Positive)</span>
                        </div>
                    </div>
                    <div>
                        <div class="prescription-field">
                            <span class="prescription-label">Date:</span>
                            <span class="prescription-value">October 16, 2023</span>
                        </div>
                        <div class="prescription-field">
                            <span class="prescription-label">Prescription ID:</span>
                            <span class="prescription-value">RX-2023-101612</span>
                        </div>
                        <div class="prescription-field">
                            <span class="prescription-label">Diagnosis Type:</span>
                            <span class="prescription-value">Provisional Diagnosis</span>
                        </div>
                        <div class="prescription-field">
                            <span class="prescription-label">Weight/Height:</span>
                            <span class="prescription-value">75 kg / 175 cm</span>
                        </div>
                    </div>
                </div>
                
                <div class="section-divider"></div>
                
                <!-- PA Assessment Section -->
                <div class="pa-assessment">
                    <div class="pa-info">
                        <div>
                            <span class="pa-name">PA Assessment by: John Mathew</span>
                            <span style="margin-left: 10px; color: var(--text-medium);">(Physician Assistant)</span>
                        </div>
                        <div class="pa-time">Time: 10:00 AM</div>
                    </div>
                    <div class="assessment-findings">
                        <div class="assessment-section">
                            <span class="assessment-label">Chief Complaint:</span>
                            <span>Fever and cough for 3 days, mild headache</span>
                        </div>
                        <div class="assessment-section">
                            <span class="assessment-label">Vitals Recorded:</span>
                            <span>Temp: 100.2Â°F, BP: 130/85 mmHg, Pulse: 78/min, RR: 18/min, SpO2: 98%</span>
                        </div>
                        <div class="assessment-section">
                            <span class="assessment-label">Allergies:</span>
                            <span>Penicillin (rash and itching)</span>
                        </div>
                    </div>
                </div>
                
                <!-- Doctor's Diagnosis -->
                <div class="compact-section">
                    <div class="compact-section-title">DOCTOR'S PROVISIONAL DIAGNOSIS</div>
                    <div style="margin-bottom: 6px;">
                        <strong>Diagnosis:</strong> Acute Upper Respiratory Infection with mild fever
                    </div>
                    <div>
                        <strong>Clinical Findings:</strong> Mild throat congestion, no tonsillar exudate. Lung sounds clear bilaterally.
                    </div>
                </div>
                
                <!-- Medications -->
                <div class="prescription-medications">
                    <div style="font-weight: 700; color: #2c3e50; margin-bottom: 10px; font-size: 14px; text-align: center;">MEDICATIONS PRESCRIBED</div>
                    <div style="white-space: pre-line; padding: 8px; background-color: #f8f9fa; border-radius: 6px; border: 1px solid #dee2e6;">
                        Amoxicillin 500mg - Twice daily for 7 days
                        Paracetamol 500mg - As needed for fever
                        Vitamin C + Zinc - Once daily for immunity
                    </div>
                </div>
                
                <!-- Investigations & Advice -->
                <div class="compact-section">
                    <div class="compact-section-title">INVESTIGATIONS ADVISED</div>
                    <div style="font-size: 11px;">Complete Blood Count (CBC) if fever persists beyond 3 days</div>
                </div>
                
                <div class="compact-section">
                    <div class="compact-section-title">GENERAL ADVICE</div>
                    <div style="font-size: 11px;">1. Take adequate rest for 3-5 days<br>
                    2. Drink plenty of warm fluids<br>
                    3. Gargle with warm salt water twice daily<br>
                    4. Follow up if symptoms worsen<br>
                    5. Next review: <strong>October 23, 2023</strong></div>
                </div>
                
                <div style="margin: 12px 0; padding: 8px; background-color: #fff3cd; border-radius: 6px; border: 1px solid #ffeaa7; font-size: 11px;">
                    <strong>ALLERGIES:</strong> Patient has known allergy to Penicillin. Avoid all penicillin-class antibiotics.
                </div>
                
                <div class="doctor-signature">
                    <div class="doctor-info">
                        <div class="doctor-name">Dr. Anil Sharma</div>
                        <div class="doctor-credentials">MBBS, MD (General Medicine)</div>
                        <div class="doctor-credentials">Reg. No: MED123456 | MCI: 12345/2010</div>
                        <div class="doctor-credentials">Consultant Physician, Apollo Hospitals</div>
                    </div>
                    <div class="signature-line"></div>
                    <div style="margin-top: 4px; font-style: italic; color: #7f8c8d; font-size: 10px;">Signature & Seal</div>
                </div>
                
                <div class="stamp-overlay">APOLLO HOSPITALS</div>
                
                <div class="footer-stamp">
                    This is a computer-generated prescription. Valid only with doctor's signature and hospital stamp.
                    <div style="margin-top: 6px; font-size: 9px;">Generated: October 16, 2023 10:45 AM | ID: RX-2023-101612 | Valid for 30 days</div>
                </div>
            `;
            
            prescriptionContainer.style.display = 'block';
            window.scrollTo({ top: prescriptionContainer.offsetTop - 100, behavior: 'smooth' });
        }

        function setupEventListeners() {
            // Mobile sidebar toggle
            mobileToggle.addEventListener('click', () => {
                sidebar.classList.toggle('active');
            });
            
            // Close sidebar when clicking outside on mobile
            document.addEventListener('click', (event) => {
                if (window.innerWidth <= 1100 && 
                    !sidebar.contains(event.target) && 
                    !mobileToggle.contains(event.target) && 
                    sidebar.classList.contains('active')) {
                    sidebar.classList.remove('active');
                }
            });
            
            // Revenue toggle functionality
            revenueToggle.addEventListener('change', () => {
                if (revenueToggle.checked) {
                    revenueAmount.classList.add('hidden');
                } else {
                    revenueAmount.classList.remove('hidden');
                }
            });
            
            // Navigation between sections
            navItems.forEach(item => {
                item.addEventListener('click', (e) => {
                    e.preventDefault();
                    const page = item.getAttribute('data-page');
                    
                    // Remove active class from all nav items
                    navItems.forEach(nav => nav.classList.remove('active'));
                    // Add active class to clicked item
                    item.classList.add('active');
                    
                    // Hide all sections
                    sections.forEach(section => section.classList.remove('active'));
                    
                    // Show selected section
                    const sectionId = `${page}Section`;
                    const section = document.getElementById(sectionId);
                    if (section) {
                        section.classList.add('active');
                    }
                    
                    // Update page title
                    const pageTitleText = item.querySelector('span').textContent;
                    pageTitle.textContent = pageTitleText;
                    
                    // Close sidebar on mobile after clicking
                    if (window.innerWidth <= 1100) {
                        sidebar.classList.remove('active');
                    }
                });
            });
            
            // Close modals
            document.getElementById('closePrescriptionModal').addEventListener('click', () => {
                prescriptionModal.style.display = 'none';
                document.body.style.overflow = 'auto';
            });
            
            document.getElementById('closePaDocsModal').addEventListener('click', () => {
                paDocumentsModal.style.display = 'none';
                document.body.style.overflow = 'auto';
            });
            
            document.getElementById('closeViewPrescriptionModal').addEventListener('click', () => {
                viewPrescriptionModal.style.display = 'none';
                document.body.style.overflow = 'auto';
            });
            
            // NEW: View PA Documents Button
            document.getElementById('viewPaDocumentsBtn').addEventListener('click', () => {
                if (currentPatientForPrescription) {
                    showPaDocumentsModal(currentPatientForPrescription.id);
                } else {
                    alert('No patient selected');
                }
            });
            
            // Close modals when clicking outside
            window.addEventListener('click', (event) => {
                if (event.target === prescriptionModal) {
                    prescriptionModal.style.display = 'none';
                    document.body.style.overflow = 'auto';
                }
                if (event.target === paDocumentsModal) {
                    paDocumentsModal.style.display = 'none';
                    document.body.style.overflow = 'auto';
                }
                if (event.target === viewPrescriptionModal) {
                    viewPrescriptionModal.style.display = 'none';
                    document.body.style.overflow = 'auto';
                }
            });
            
            // View Final Prescription Button
            document.getElementById('viewFinalPrescriptionBtn').addEventListener('click', () => {
                showSamplePrescription();
            });
            
            // Close Final Prescription Button
            document.getElementById('closeFinalPrescriptionBtn').addEventListener('click', () => {
                document.getElementById('finalPrescriptionView').style.display = 'none';
            });
            
            // Print Final Prescription Button
            document.getElementById('printFinalPrescriptionBtn').addEventListener('click', () => {
                window.print();
            });
            
            // Event delegation for all click events
            document.addEventListener('click', (e) => {
                // Start prescription from queue
                if (e.target.closest('.start-consult-btn')) {
                    const patientId = e.target.closest('.start-consult-btn').getAttribute('data-id');
                    showPrescriptionModal(patientId);
                }
                
                // Call next patient
                if (e.target.closest('#callNextPatientBtn') || e.target.closest('#callNextFullBtn')) {
                    const nextPatient = consultationQueue.find(p => p.status === 'ready');
                    if (nextPatient) {
                        alert(`Calling next patient: ${nextPatient.name}`);
                        // In real app, this would update queue and status
                    } else {
                        alert('No patients ready for consultation');
                    }
                }
                
                // View patient
                if (e.target.closest('.view-patient-btn')) {
                    const patientId = e.target.closest('.view-patient-btn').getAttribute('data-id');
                    const patient = patientsWithPA.find(p => p.id === patientId);
                    if (patient) {
                        alert(`Patient Details:\n\n` +
                              `Name: ${patient.name}\n` +
                              `ID: ${patient.id}\n` +
                              `Age/Gender: ${patient.age} yrs / ${patient.gender}\n` +
                              `Phone: ${patient.phone}\n` +
                              `Registered by: ${patient.registeredBy}\n` +
                              `Chief Complaint: ${patient.chiefComplaint}`);
                    }
                }
                
                // NEW: View final prescription from Prescription Management
                if (e.target.closest('.view-final-prescription-btn')) {
                    const prescriptionId = e.target.closest('.view-final-prescription-btn').getAttribute('data-id');
                    viewFinalPrescription(prescriptionId);
                }
                
                // Print prescription
                if (e.target.closest('[data-action="print"]')) {
                    const prescriptionId = e.target.closest('[data-action="print"]').getAttribute('data-id');
                    alert(`Printing prescription: ${prescriptionId}`);
                }
            });
            
            // Notification button
            document.getElementById('notificationBtn').addEventListener('click', () => {
                alert('Notifications:\n1. Patient Rajesh Kumar ready for consultation\n2. New PA assessment completed for Meena Desai\n3. 2 patients waiting in queue\n4. System backup completed\n5. Weekly report ready');
            });
            
            // Dashboard card clicks
            document.getElementById('todaysConsultationsCard').addEventListener('click', () => {
                document.querySelector('[data-page="consultationQueue"]').click();
            });
            
            document.getElementById('prescriptionsCard').addEventListener('click', () => {
                document.querySelector('[data-page="prescriptions"]').click();
            });
        }
    </script>
</body>
</html>